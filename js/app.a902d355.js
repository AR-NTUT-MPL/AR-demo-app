(function(t){function e(e){for(var a,o,r=e[0],p=e[1],c=e[2],u=0,h=[];u<r.length;u++)o=r[u],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&h.push(n[o][0]),n[o]=0;for(a in p)Object.prototype.hasOwnProperty.call(p,a)&&(t[a]=p[a]);l&&l(e);while(h.length)h.shift()();return i.push.apply(i,c||[]),s()}function s(){for(var t,e=0;e<i.length;e++){for(var s=i[e],a=!0,r=1;r<s.length;r++){var p=s[r];0!==n[p]&&(a=!1)}a&&(i.splice(e--,1),t=o(o.s=s[0]))}return t}var a={},n={app:0},i=[];function o(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=t,o.c=a,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(s,a,function(e){return t[e]}.bind(null,a));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],p=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var l=p;i.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},1:function(t,e){},2:function(t,e){},"2c2e":function(t,e,s){"use strict";s("fbab")},3:function(t,e){},4:function(t,e){},5:function(t,e){},"56d7":function(t,e,s){"use strict";s.r(e);s("e260"),s("e6cf"),s("cca6"),s("a79d");var a=s("2b0e"),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("v-app",[s("header",[s("v-container",[s("v-row",[s("v-col",{attrs:{cols:"12",md:"8"}},[s("h1",[t._v(" Compact design principle for diffractive exit-pupil expander in AR near-eye system ")]),s("br"),s("h3",[t._v("2021 SPIE. AR|VR|MR")])]),s("v-spacer"),s("v-col",[s("h2",{staticClass:"lab-name"},[t._v("Modern Nanophotonics Lab")])])],1)],1)],1),s("section",[s("v-container",[s("v-card",[s("v-card-title",[t._v("Interactive Application")]),s("v-card-text",[s("div",{staticClass:"names"},[s("span",[t._v("Po-Han Chiu"),s("sup",[t._v("*a")])]),s("span",[t._v("Ting-Wei Huang"),s("sup",[t._v("a")])]),s("span",[t._v("Yun-Shou Hsu"),s("sup",[t._v("a")])]),s("span",[t._v("Bo-Kai Zhang"),s("sup",[t._v("a")])]),s("span",[t._v("Szu-Ta Chien"),s("sup",[t._v("a")])]),s("span",[t._v("Wen-Chang Hung"),s("sup",[t._v("b")])]),s("span",[t._v("Chien-Yi Huang"),s("sup",[t._v("b")])]),s("span",[t._v("Yu-Chieh Cheng"),s("sup",[t._v("a")])])]),s("div",[s("p",[s("sup",[t._v("a")]),t._v("National Taipei University of Technology, No. 1, Section 3, Zhongxiao East Road, Da'an Dist., Taipei, 10608, Taiwan"),s("br"),s("sup",[t._v("b")]),t._v("ASUSTeK COMPUTER INC, No. 115, Li-De Rd., Beitou Dist., Taipei 112019, Taiwan ")])])]),s("v-divider",{staticClass:"mx-4"}),s("v-card-text",[s("h3",[t._v("Abstract")]),s("p",[t._v(" For a diffractive-waveguide-based augmented reality display, we demonstrate a rapid and straightforward method to define the most compact layout of an exit pupil expander (EPE) from an analysis of diffractive optical elements in k-space. The idea is to consider all k-vectors coming from in-coupling to out-coupling areas according to the grating theory, tracing out the EPE grating region, and with a geometrical modeling of this problem to find the optimal layout. For a working wavelength of 532 nm, 40 degrees field of view display, the solution to pack the entire layout into a enclosed circle radius and minimum area of EPE is presented. Furthermore, a web-based interactive application demonstrating the EPE layout calculation is provided as a layout design tool. ")]),s("p",[s("strong",[t._v("Keywords:")]),t._v(" Near-eye display, Waveguide, Augmented Reality, Exit-Pupil Expander, Diffractive Optical Elements. ")])])],1)],1)],1),s("Main"),s("footer",[s("v-container",[s("v-row",[s("v-col",[s("p",[t._v(" Web Designer/Developer: Hans Chiu (Po-Han Chiu) "),s("br"),t._v(" Email: t110658013@ntut.org.tw ")]),s("p",[t._v("Developed with: Vue, Vuetify, Fabric, TensorFlow")])]),s("v-col",[s("p",[t._v(" This project is aimed to give readers a interactive way to understand the principle behind waveguide based AR glasses. ")]),s("p",[t._v("Â© 2021 TaipeiTech")])])],1)],1)],1)],1)],1)},i=[],o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("section",[s("v-container",[s("v-card",[s("v-card-title",[t._v("Basic Settings")]),s("v-card-text",[s("v-row",{staticClass:"my-0"},[s("v-col",{staticClass:"py-0",attrs:{cols:"6",md:"2"}},[s("v-text-field",{attrs:{label:"Wavelength",suffix:"nm"},model:{value:t.props.wavelength,callback:function(e){t.$set(t.props,"wavelength",t._n(e))},expression:"props.wavelength"}})],1),s("v-col",{staticClass:"py-0",attrs:{cols:"6",md:"2"}},[s("v-text-field",{attrs:{label:"Refractive Index"},model:{value:t.props.material,callback:function(e){t.$set(t.props,"material",t._n(e))},expression:"props.material"}})],1),s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"6",md:"5"}},[s("v-slider",{attrs:{label:"FOV",min:"0",max:"150",tick:"1","thumb-label":""},scopedSlots:t._u([{key:"append",fn:function(){return[s("v-text-field",{staticClass:"mt-0 pt-0",attrs:{dense:"",suffix:"degrees"},model:{value:t.props.FOV,callback:function(e){t.$set(t.props,"FOV",t._n(e))},expression:"props.FOV"}})]},proxy:!0}]),model:{value:t.props.FOV,callback:function(e){t.$set(t.props,"FOV",e)},expression:"props.FOV"}})],1),s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"6",md:"3"}},[s("v-row",[s("v-col",[s("v-text-field",{attrs:{label:"Aspect"},model:{value:t.props.aspect[0],callback:function(e){t.$set(t.props.aspect,0,t._n(e))},expression:"props.aspect[0]"}})],1),s("v-col",[s("v-text-field",{model:{value:t.props.aspect[1],callback:function(e){t.$set(t.props.aspect,1,t._n(e))},expression:"props.aspect[1]"}})],1)],1)],1)],1),s("v-row",{staticClass:"my-n4"},[s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"6"}},[s("v-slider",{attrs:{label:"x offset",dense:"",min:"-1",max:"1",step:"0.1","thumb-label":""},scopedSlots:t._u([{key:"append",fn:function(){return[s("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{dense:""},model:{value:t.props.offset[0],callback:function(e){t.$set(t.props.offset,0,t._n(e))},expression:"props.offset[0]"}})]},proxy:!0}]),model:{value:t.props.offset[0],callback:function(e){t.$set(t.props.offset,0,e)},expression:"props.offset[0]"}})],1),s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"6"}},[s("v-slider",{attrs:{label:"y offset",dense:"",min:"-1",max:"1",step:"0.1"},scopedSlots:t._u([{key:"append",fn:function(){return[s("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{dense:"","thumb-label":""},model:{value:t.props.offset[1],callback:function(e){t.$set(t.props.offset,1,t._n(e))},expression:"props.offset[1]"}})]},proxy:!0}]),model:{value:t.props.offset[1],callback:function(e){t.$set(t.props.offset,1,e)},expression:"props.offset[1]"}})],1)],1)],1)],1)],1)],1),s("section",[s("v-container",[s("v-row",[s("v-col",{attrs:{sm:"6"}},[s("v-card",[s("v-card-title",[t._v("K Space ")]),s("v-card-text",[s("p",[t._v("Drag to modify grating parameters.")])]),s("KSpace",{attrs:{g1:t.props.g1,g3:t.props.g3,k0:t.k0,k1:t.k1,k2:t.k2,k3:t.k3,material:t.props.material},on:{"update:g1":function(e){return t.$set(t.props,"g1",e)},"update:g3":function(e){return t.$set(t.props,"g3",e)}}}),s("v-card-text",[s("div",[s("v-row",[s("v-col",{attrs:{cols:"2"}}),s("v-col",[s("v-label",[t._v("Period")])],1),s("v-col",[s("v-label",[t._v("Angle")])],1)],1),s("v-row",{staticClass:"mt-n4"},[s("v-col",{staticClass:"text-right mt-1",attrs:{cols:"2"}},[s("v-label",[t._v(" In ")])],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},on:{change:function(e){return t.grating_period_update("g1",e)}},model:{value:t.g1_period,callback:function(e){t.g1_period=t._n(e)},expression:"g1_period"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},on:{change:function(e){return t.grating_angle_update("g1",e)}},model:{value:t.g1_angle,callback:function(e){t.g1_angle=t._n(e)},expression:"g1_angle"}})],1)],1),s("v-row",{staticClass:"mt-n8"},[s("v-col",{staticClass:"text-right mt-1",attrs:{cols:"2"}},[s("v-label",[t._v(" EPE ")])],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:"",readonly:""},model:{value:t.g2_period,callback:function(e){t.g2_period=t._n(e)},expression:"g2_period"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:"",readonly:""},model:{value:t.g2_angle,callback:function(e){t.g2_angle=t._n(e)},expression:"g2_angle"}})],1)],1),s("v-row",{staticClass:"mt-n8"},[s("v-col",{staticClass:"text-right mt-1",attrs:{cols:"2"}},[s("v-label",[t._v(" Out ")])],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},on:{change:function(e){return t.grating_period_update("g3",e)}},model:{value:t.g3_period,callback:function(e){t.g3_period=t._n(e)},expression:"g3_period"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},on:{change:function(e){return t.grating_angle_update("g3",e)}},model:{value:t.g3_angle,callback:function(e){t.g3_angle=t._n(e)},expression:"g3_angle"}})],1)],1)],1),s("p",[t._v("Note: EPE parameters are automatically calculated.")])])],1)],1),s("v-col",{attrs:{sm:"6"}},[s("v-card",[s("v-card-title",[t._v(" Layout ")]),s("v-card-text",[s("p",[t._v("Drag to modify layout placement.")])]),s("Layout",{attrs:{in_pos:t.props.in_pos,in_size:t.props.in_size,in_shape1:t.in_shape1,in_shape2:t.in_shape2,out_pos:t.props.out_pos,out_size:t.props.out_size,out_shape1:t.out_shape1,out_shape2:t.out_shape2,epe_shape:t.epe_shape,background_image:t.background_image},on:{"update:in_pos":function(e){return t.$set(t.props,"in_pos",e)},"update:in_size":function(e){return t.$set(t.props,"in_size",e)},"update:out_pos":function(e){return t.$set(t.props,"out_pos",e)},"update:out_size":function(e){return t.$set(t.props,"out_size",e)}}}),s("v-card-text",[s("div",[s("v-row",[s("v-col",{attrs:{cols:"2"}}),s("v-col",[s("v-label",[t._v("x")])],1),s("v-col",[s("v-label",[t._v("y")])],1),s("v-col",[s("v-label",[t._v("z")])],1)],1),s("v-row",{staticClass:"mt-n4"},[s("v-col",{staticClass:"text-right mt-1",attrs:{cols:"2"}},[s("v-label",[t._v("In")])],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},model:{value:t.props.in_pos[0],callback:function(e){t.$set(t.props.in_pos,0,t._n(e))},expression:"props.in_pos[0]"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},model:{value:t.props.in_pos[1],callback:function(e){t.$set(t.props.in_pos,1,t._n(e))},expression:"props.in_pos[1]"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},model:{value:t.props.in_displace,callback:function(e){t.$set(t.props,"in_displace",t._n(e))},expression:"props.in_displace"}})],1)],1),s("v-row",{staticClass:"mt-n8"},[s("v-col",{staticClass:"text-right mt-1",attrs:{cols:"2"}},[s("v-label",[t._v("Out")])],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},model:{value:t.props.out_pos[0],callback:function(e){t.$set(t.props.out_pos,0,t._n(e))},expression:"props.out_pos[0]"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},model:{value:t.props.out_pos[1],callback:function(e){t.$set(t.props.out_pos,1,t._n(e))},expression:"props.out_pos[1]"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},model:{value:t.props.out_displace,callback:function(e){t.$set(t.props,"out_displace",t._n(e))},expression:"props.out_displace"}})],1)],1),s("v-row",{staticClass:"mt-n4"},[s("v-col",[s("v-row",{staticClass:"mt-n4"},[s("v-col",[s("v-select",{attrs:{items:t.shape_types,label:"In shape",dense:""},model:{value:t.props.in_shape_type,callback:function(e){t.$set(t.props,"in_shape_type",e)},expression:"props.in_shape_type"}})],1)],1),s("v-row",{staticClass:"mt-n4"},[s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:"",label:"width"},model:{value:t.props.in_size[0],callback:function(e){t.$set(t.props.in_size,0,t._n(e))},expression:"props.in_size[0]"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:"",label:"height"},model:{value:t.props.in_size[1],callback:function(e){t.$set(t.props.in_size,1,t._n(e))},expression:"props.in_size[1]"}})],1)],1)],1),s("v-col",[s("v-row",{staticClass:"mt-n4"},[s("v-col",[s("v-select",{attrs:{items:t.shape_types,label:"Out shape",dense:""},model:{value:t.props.out_shape_type,callback:function(e){t.$set(t.props,"out_shape_type",e)},expression:"props.out_shape_type"}})],1)],1),s("v-row",{staticClass:"mt-n4"},[s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:"",label:"width"},model:{value:t.props.out_size[0],callback:function(e){t.$set(t.props.out_size,0,t._n(e))},expression:"props.out_size[0]"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:"",label:"height"},model:{value:t.props.out_size[1],callback:function(e){t.$set(t.props.out_size,1,t._n(e))},expression:"props.out_size[1]"}})],1)],1)],1)],1)],1)])],1)],1)],1)],1)],1),s("section",[s("v-container",[s("v-card",[s("v-card-title",[t._v(" Customization ")]),s("v-card-text",[s("v-row",[s("v-col",[s("v-file-input",{attrs:{label:"Background Image",dense:""},on:{change:t.update_background_image}})],1)],1)],1)],1)],1)],1),s("section",[s("v-container",[s("v-card",[s("v-card-title",[t._v(" Parameters ")]),s("v-card-text",[t._l(Object.keys(t.props),(function(e){return[s("v-row",{key:e,staticClass:"mt-n4"},[s("v-col",{staticClass:"text-right",attrs:{cols:"4",sm:"3"}},[s("label",{attrs:{for:e}},[t._v(t._s(e)+": ")])]),s("v-col",[t.isArray(t.props[e])?t._l(t.props[e],(function(a,n){return s("span",{key:n},[s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.props[e][n],expression:"props[prop][i]",modifiers:{number:!0}}],attrs:{name:e,type:"text"},domProps:{value:t.props[e][n]},on:{input:function(s){s.target.composing||t.$set(t.props[e],n,t._n(s.target.value))},blur:function(e){return t.$forceUpdate()}}})])})):[s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.props[e],expression:"props[prop]",modifiers:{number:!0}}],attrs:{name:e,type:"text"},domProps:{value:t.props[e]},on:{input:function(s){s.target.composing||t.$set(t.props,e,t._n(s.target.value))},blur:function(e){return t.$forceUpdate()}}})]],2)],1)]}))],2)],1)],1)],1),s("div",{attrs:{hidden:""}},[t._v(" "+t._s(t.epe_shape_prop)+" ")])])},r=[],p=s("2909"),c=s("3835"),l=s("1da1"),u=(s("99af"),s("96cf"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"base"},[s("canvas",{ref:"canvas",staticClass:"canvas",attrs:{width:"500",height:"500"}}),s("div",{attrs:{hidden:""}},[t._v(" "+t._s(t.g1_props)+" "+t._s(t.g3_props)+" "+t._s(t.points)+" "+t._s(t.circle_props)+" ")])])}),h=[],d=(s("a9e3"),s("7a94")),v={data:function(){return{canvas:null,alive:!1}},mounted:function(){this.alive=!0,this.canvas=new d["fabric"].Canvas(this.$refs.canvas),window.addEventListener("resize",this.resize_event),this.resize()},destroyed:function(){this.alive=!1,this.canvas.dispose(),window.removeEventListener("resize",this.resize_event)},methods:{resize_event:function(){this.resize()},resize:function(){},updatePolygon:function(t){var e=t._calcDimensions(),s=e.width,a=e.height,n=e.left,i=e.top,o=2*Math.max(Math.abs(n),Math.abs(n+s)),r=2*Math.max(Math.abs(i),Math.abs(i+a));t.set({width:o,height:r}).setCoords()}}};s("d3b7");function _(t,e){var s=null,a=null,n=null;function i(){var i=this,o=arguments,r=(new Date).getTime();return clearTimeout(a),!s||r-s>e?(n=t.apply(i,o),s=r):a=setTimeout((function(){n=t.apply(i,o),s=null}),e),n}return i}function f(t){var e=null,s=!1;function a(){var n=arguments,i=this,o=arguments;if(clearTimeout(e),!s)return s=!0,new Promise((function(e){t.apply(i,o).then((function(){e(n)})).finally((function(){s=!1}))}));e=setTimeout((function(){a.apply(i,o)}),0)}return a}s("4c53"),s("fb6a"),s("4e827");var g=s("ce1a"),m=s("b85c");function b(t){var e,s=0,a=Object(m["a"])(t);try{for(a.s();!(e=a.n()).done;){var n=e.value;s+=Math.pow(n,2)}}catch(i){a.e(i)}finally{a.f()}return s}function y(t){return Math.sqrt(b(t))}g["s"]("cpu");var k=function(t,e,s,a,n,i){var o=y([n,i]),r=o/2/Math.tan(e/2),p=.5*n*s,c=.5*i*a,l=O(+p,+c,+n-2*Math.abs(p),+i-2*Math.abs(c),8);return g["j"]([p,c]),l.div(l.pow(2).sum(0).add(Math.pow(r,2)).sqrt()).mul(t)},x=function(t,e){return g["a"](g["w"](t),g["w"]([[e[0]],[e[1]]]))},w=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=g["n"](g["i"](t),e),a=g["n"](g["t"](t),e);return g["d"](a,s)},C=function(t){var e=g["d"](t[0],t[1]),s=e.sub(w(e)).add(Math.PI).mod(2*Math.PI).sub(Math.PI),a=g["b"](s).arraySync(),n=g["c"](s).arraySync();return g["j"]([e,s]),[a,n]},P=function(t,e){return g["u"](g["v"](Math.pow(e,2),g["p"](t,t).sum(0)))},z=function(t,e){return g["k"](t,P(t,e))};function $(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return g["f"]([g["m"](t,e,!0),g["o"](t,e,!0)],e)}var M=function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(e,s,a,n,i,o,r,p,c,l){var u,h,d,v,_,f,m,b,y,k,x,w,C,P,M,O,A;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return u=z(p,r).mul(a),h=z(p,r).mul(-o),d=g["l"](e,1).add(u),v=g["l"](n,1).add(h),_=g["v"](v,d),f=g["p"]([c[1],c[0]],[[-1],[1]]),m=g["p"]([l[1],l[0]],[[-1],[1]]),b=v.sub(g["e"](l,"float32").mul(g["p"](_,f).sum(0)).div(g["p"](l,f).sum(0))),y=$(g["p"](g["l"](s,1),g["l"](f,2)).sum(0),1).mul(g["p"](f,l).sum(0).div(g["p"](f,f).sum(0)).div(g["p"](l,l).sum(0)).expandDims(1)),k=$(g["p"](g["l"](i,1),g["l"](m,2)).sum(0),1).mul(g["p"](m,c).sum(0).div(g["p"](m,m).sum(0)).div(g["p"](c,c).sum(0)).expandDims(1)),g["j"](_,f,m,b),x=g["p"](k.gather(0,1),c),w=g["p"](k.gather(1,1),c),C=g["p"](y.gather(0,1),l),P=g["p"](y.gather(1,1),l),t.next=17,T(g["f"]([b.add(x).add(C),b.add(w).add(C),b.add(x).add(P),b.add(w).add(P)],1)).array();case 17:return M=t.sent,t.next=20,I(u,s).array();case 20:return O=t.sent,t.next=23,I(h,i).array();case 23:return A=t.sent,g["j"](k,y,x,w,C,P),t.abrupt("return",[O,M,A]);case 26:case"end":return t.stop()}}),t)})));return function(e,s,a,n,i,o,r,p,c,l){return t.apply(this,arguments)}}();function O(t,e,s,a,n){var i=g["r"](0,n+1).div(n).sub(.5),o=i.reverse();i=i.slice(0,n),o=o.slice(0,n);var r=g["q"]([n]).mul(.5),p=r.mul(-1),c=g["g"]([i,r,o,p]).mul(s).add(t),l=g["g"]([p,i,r,o]).mul(a).add(e);return g["h"]([c.expandDims(0),l.expandDims(0)])}function A(t,e,s,a,n){var i=g["r"](0,n).div(n).mul(2*Math.PI),o=g["i"](i).mul(s/2).add(t),r=g["t"](i).mul(a/2).add(e);return g["h"]([o.expandDims(0),r.expandDims(0)])}function S(t,e){for(var s=[],a=0;a<t[0].length;a++)s.push({x:t[0][a]*e,y:-t[1][a]*e});return s}function V(t,e){var s=C(t),a=Object(c["a"])(s,2),n=a[0],i=a[1];return[{x:0,y:0},{x:t[0][n]*e,y:-t[1][n]*e},{x:t[0][i]*e,y:-t[1][i]*e}]}function j(t,e,s){return(e[0]-t[0])*(s[1]-t[1])-(e[1]-t[1])*(s[0]-t[0])}function R(t){for(var e=[],s=0;s<t[0].length;s++)e.push(s);e.sort((function(e,s){return t[0][e]<t[0][s]?-1:t[0][e]>t[0][s]?1:t[1][e]-t[1][s]}));for(var a=[],n=[],i=0,o=e;i<o.length;i++){var r=o[i];while(n.length>=2&&j([t[0][n[n.length-2]],t[1][n[n.length-2]]],[t[0][n[n.length-1]],t[1][n[n.length-1]]],[t[0][r],t[1][r]])<=0)n.pop();while(n.length>=2&&j([t[0][a[a.length-2]],t[1][a[a.length-2]]],[t[0][a[a.length-1]],t[1][a[a.length-1]]],[t[0][r],t[1][r]])>=0)a.pop();n.push(r),a.push(r)}return n.concat(a.slice(1,-1).reverse())}function T(t){var e=g["e"](t,"float32");t=e.arraySync();var s=R(t);return e.gather(s,1)}var I=function(t,e){var s=g["l"](t,1),a=g["l"](e,2);return T(s.add(a).reshape([2,-1]))},E={props:{g1:Array,g3:Array,k0:Number,k1:Array,k2:Array,k3:Array,material:Number},mixins:[v],data:function(){return{canvas:null,k1_shape:null,k2_shape:null,k3_shape:null,circle1:null,circle2:null,k2_span_shape:null,k3_span_shape:null}},mounted:function(){this.canvas.add(this.k1_shape=new d["fabric"].Polygon([],{fill:"#37474f",left:0,top:0,originX:"center",originY:"center",evented:!1})),this.canvas.add(this.k2_span_shape=new d["fabric"].Polygon([],{fill:"#ffcc8080",left:0,top:0,originX:"center",originY:"center",evented:!1})),this.canvas.add(this.k3_span_shape=new d["fabric"].Polygon([],{fill:"#90caf980",left:0,top:0,originX:"center",originY:"center",evented:!1})),this.canvas.add(this.circle1=new d["fabric"].Circle({stroke:"black",fill:null,strokeWidth:2,radius:1e3,selectable:!1,originX:"center",originY:"center",evented:!1})),this.canvas.add(this.circle2=new d["fabric"].Circle({stroke:"black",fill:null,strokeWidth:2,radius:1e3,selectable:!1,originX:"center",originY:"center",evented:!1})),this.canvas.set("scaleY",-1),this.k2_shape=this.create_k_patch("#ff9800",this.g1_update),this.k3_shape=this.create_k_patch("#2196f3",this.g3_update),this.canvas.absolutePan(new d["fabric"].Point(-this.canvas.width/2,-this.canvas.height/2)),this.canvas.selection=!1},methods:{resize:function(){var t=this.$refs.base.getBoundingClientRect().width;this.canvas.setWidth(t),this.canvas.setHeight(t),this.canvas.calcOffset(),this.canvas.absolutePan(new d["fabric"].Point(-this.canvas.width/2,-this.canvas.height/2))},create_k_patch:function(t,e){var s=new d["fabric"].Polygon([],{fill:t,originX:"center",originY:"center",stroke:"white",strokeWidth:2,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,hasControls:!1}).on("modified",e).on("moving",e);return this.canvas.add(s),s},g1_update:_((function(){this.$emit("update:g1",[this.k2_shape.get("left")/this.scaling,-this.k2_shape.get("top")/this.scaling])}),20),g3_update:_((function(){this.$emit("update:g3",[-this.k3_shape.get("left")/this.scaling,this.k3_shape.get("top")/this.scaling])}),20)},computed:{k0_mat:function(){return this.k0*this.material},scaling:function(){return this.canvas.width/2/this.k0_mat*.8},g1_props:function(){return this.k2_shape?(this.k2_shape.set("left",this.g1[0]*this.scaling),this.k2_shape.set("top",-this.g1[1]*this.scaling),this.k2_shape.setCoords(),this.k2_span_shape.set("points",V(this.k2,this.scaling)),this.updatePolygon(this.k2_span_shape),this.canvas.requestRenderAll(),0):0},g3_props:function(){return this.k3_shape?(this.k3_shape.set("left",-this.g3[0]*this.scaling),this.k3_shape.set("top",this.g3[1]*this.scaling),this.k3_shape.setCoords(),this.k3_span_shape.set("points",V(this.k3,this.scaling)),this.updatePolygon(this.k3_span_shape),this.canvas.requestRenderAll(),0):0},points:function(){if(!this.k1_shape)return 0;var t=S(this.k1,this.scaling);return this.k1_shape.set("points",t),this.k2_shape.set("points",t),this.k3_shape.set("points",t),this.updatePolygon(this.k1_shape),this.updatePolygon(this.k2_shape),this.updatePolygon(this.k3_shape),this.canvas.requestRenderAll(),0},circle_props:function(){return this.circle1?(this.circle1.set("radius",this.k0*this.scaling),this.circle2.set("radius",this.k0_mat*this.scaling),this.circle1.setCoords(),this.circle2.setCoords(),this.canvas.requestRenderAll(),0):0}}},D=E,Y=s("2877"),F=Object(Y["a"])(D,u,h,!1,null,null,null),N=F.exports,X=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"base"},[s("div",{staticClass:"layout-container"},[s("div",{staticClass:"layout-canvas-bg",style:{backgroundImage:"url("+t.background_image+")"}}),s("div",[s("canvas",{ref:"canvas",staticClass:"canvas",attrs:{width:"500",height:"500"}})])]),s("div",{attrs:{hidden:""}},[t._v(" "+t._s(t.in_props)+" "+t._s(t.out_props)+" "+t._s(t.epe_props)+" ")])])},W=[],q={props:{in_pos:Array,in_size:Array,in_shape1:Array,in_shape2:Array,out_pos:Array,out_size:Array,out_shape1:Array,out_shape2:Array,epe_shape:Array,background_image:String},mixins:[v],data:function(){return{canvas:null,in_patch1:null,in_patch2:null,out_patch1:null,out_patch2:null,epe_patch:null}},mounted:function(){this.canvas.selection=!1,this.canvas.add(this.in_patch2=new d["fabric"].Polygon([],{fill:"#37474f80",originX:"center",originY:"center",evented:!1})),this.canvas.add(this.out_patch2=new d["fabric"].Polygon([],{fill:"#2196f380",originX:"center",originY:"center",evented:!1})),this.canvas.add(this.epe_patch=new d["fabric"].Polygon([],{fill:"#ff980080",originX:"center",originY:"center",evented:!1})),this.in_patch1=this.create_coupling_patch("#37474f",this.in_update),this.out_patch1=this.create_coupling_patch("#2196f3",this.out_update)},methods:{resize:function(){var t=this.$refs.base.getBoundingClientRect().width;this.canvas.setWidth(t),this.canvas.setHeight(t),this.canvas.calcOffset(),this.canvas.absolutePan(new d["fabric"].Point(-this.canvas.width/2,-this.canvas.height/2))},create_coupling_patch:function(t,e){var s=new d["fabric"].Polygon([],{fill:t,originX:"center",originY:"center",lockRotation:!0,width:100,height:100}).on("modified",e).on("moving",e);return this.canvas.add(s),s},in_update:_((function(){this.$emit("update:in_pos",[this.in_patch1.get("left")/this.scaling,-this.in_patch1.get("top")/this.scaling]),this.$emit("update:in_size",[this.in_patch1.get("scaleX")*this.in_size[0],this.in_patch1.get("scaleY")*this.in_size[1]]),this.in_patch1.set("scaleX",1),this.in_patch1.set("scaleY",1)}),20),out_update:_((function(){this.$emit("update:out_pos",[this.out_patch1.get("left")/this.scaling,-this.out_patch1.get("top")/this.scaling]),this.$emit("update:out_size",[this.out_patch1.get("scaleX")*this.out_size[0],this.out_patch1.get("scaleY")*this.out_size[1]]),this.out_patch1.set("scaleX",1),this.out_patch1.set("scaleY",1)}),20)},computed:{scaling:function(){return this.canvas.width/80},in_props:function(){return this.in_patch1?(this.in_patch1.set("left",this.in_pos[0]*this.scaling),this.in_patch1.set("top",-this.in_pos[1]*this.scaling),this.in_patch1.setCoords(),this.in_patch1.set("points",S(this.in_shape1,this.scaling)),this.updatePolygon(this.in_patch1),this.in_patch2.set("left",this.in_pos[0]*this.scaling),this.in_patch2.set("top",-this.in_pos[1]*this.scaling),this.in_patch2.setCoords(),this.in_patch2.set("points",S(this.in_shape2,this.scaling)),this.updatePolygon(this.in_patch2),this.canvas.requestRenderAll(),0):0},out_props:function(){return this.out_patch1?(this.out_patch1.set("left",this.out_pos[0]*this.scaling),this.out_patch1.set("top",-this.out_pos[1]*this.scaling),this.out_patch1.setCoords(),this.out_patch1.set("points",S(this.out_shape1,this.scaling)),this.updatePolygon(this.out_patch1),this.out_patch2.set("left",this.out_pos[0]*this.scaling),this.out_patch2.set("top",-this.out_pos[1]*this.scaling),this.out_patch2.setCoords(),this.out_patch2.set("points",S(this.out_shape2,this.scaling)),this.updatePolygon(this.out_patch2),this.canvas.requestRenderAll(),0):0},epe_props:function(){return this.out_patch1?(this.epe_patch.set("points",S(this.epe_shape,this.scaling)),this.updatePolygon(this.epe_patch),this.canvas.requestRenderAll(),0):0}}},H=q,L=(s("2c2e"),Object(Y["a"])(H,X,W,!1,null,"b86eeaf8",null)),B=L.exports,K=2*Math.PI/394,U={name:"HelloWorld",components:{KSpace:N,Layout:B},props:{},data:function(){return{props:{wavelength:530,material:1.827,FOV:40,aspect:[4,3],offset:[0,0],g1:[K,0],g3:[0,-K],in_size:[4,4],in_displace:0,in_pos:[-25,-15],in_shape_type:"circle",out_size:[16,16],out_displace:20,out_pos:[5,15],out_shape_type:"circle"},epe_shape:[[0],[0]],in_shape2:[[0],[0]],out_shape2:[[0],[0]],shape_types:["circle","rectangle"],background_image:""}},methods:{isArray:function(t){return t instanceof Array},grating_period_update:function(t,e){if(isNaN(e)&&(e=0),0!=e){var s=2*Math.PI/e/y(this.props[t]);this.props[t][0]*=s,this.props[t][1]*=s,this.props[t].__ob__.dep.notify()}},grating_angle_update:function(t,e){isNaN(e)&&(e=0);var s=y(this.props[t]);this.props[t][0]=Math.cos(e*Math.PI/180)*s,this.props[t][1]=Math.sin(e*Math.PI/180)*s,this.props[t].__ob__.dep.notify()},update_epe:_(f(Object(l["a"])(regeneratorRuntime.mark((function t(){var e,s,a,n,i,o,r=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this,t.next=3,M.apply(void 0,r);case 3:return s=t.sent,a=Object(c["a"])(s,3),n=a[0],i=a[1],o=a[2],e.in_shape2=n,e.epe_shape=i,e.out_shape2=o,t.abrupt("return",0);case 12:case"end":return t.stop()}}),t,this)})))),1),update_background_image:function(t){if(t){var e=new FileReader,s=this;e.onloadend=function(){s.background_image=e.result,console.log(e.result)},e.readAsDataURL(t)}}},computed:{k0:function(){return 2*Math.PI/this.props.wavelength},k1:function(){return k.apply(void 0,[this.k0,this.props.FOV/180*Math.PI].concat(Object(p["a"])(this.props.offset),Object(p["a"])(this.props.aspect))).arraySync()},k2:function(){return x(this.k1,this.props.g1).arraySync()},k3:function(){return x(this.k2,this.g2).arraySync()},TIR:function(){return Math.asin(1/this.props.material)},g2:function(){return[-this.props.g1[0]-this.props.g3[0],-this.props.g1[1]-this.props.g3[1]]},g1_period:{get:function(){return 2*Math.PI/y(this.props.g1)},set:function(){}},g1_angle:{get:function(){return 180*Math.atan2(this.props.g1[1],this.props.g1[0])/Math.PI},set:function(){}},g2_period:{get:function(){return 2*Math.PI/y(this.g2)},set:function(){}},g2_angle:{get:function(){return 180*Math.atan2(this.g2[1],this.g2[0])/Math.PI},set:function(){}},g3_period:{get:function(){return 2*Math.PI/y(this.props.g3)},set:function(){}},g3_angle:{get:function(){return 180*Math.atan2(this.props.g3[1],this.props.g3[0])/Math.PI},set:function(){}},in_shape1:function(){return"circle"==this.props.in_shape_type?A.apply(void 0,[0,0].concat(Object(p["a"])(this.props.in_size),[32])).arraySync():O.apply(void 0,[0,0].concat(Object(p["a"])(this.props.in_size),[1])).arraySync()},out_shape1:function(){return"circle"==this.props.out_shape_type?A.apply(void 0,[0,0].concat(Object(p["a"])(this.props.out_size),[32])).arraySync():O.apply(void 0,[0,0].concat(Object(p["a"])(this.props.out_size),[1])).arraySync()},epe_shape_prop:function(){return this.update_epe(this.props.in_pos,this.in_shape1,this.props.in_displace,this.props.out_pos,this.out_shape1,this.props.out_displace,this.k0,this.k1,this.k2,this.k3),0}}},J=U,Z=s("6544"),G=s.n(Z),Q=s("b0af"),tt=s("99d9"),et=s("62ad"),st=s("a523"),at=s("23a7"),nt=s("24c9"),it=s("0fd9"),ot=s("b974"),rt=s("ba0d"),pt=s("8654"),ct=Object(Y["a"])(J,o,r,!1,null,"77edfa78",null),lt=ct.exports;G()(ct,{VCard:Q["a"],VCardText:tt["a"],VCardTitle:tt["b"],VCol:et["a"],VContainer:st["a"],VFileInput:at["a"],VLabel:nt["a"],VRow:it["a"],VSelect:ot["a"],VSlider:rt["a"],VTextField:pt["a"]});var ut={name:"App",components:{Main:lt}},ht=ut,dt=(s("5c0b"),s("7496")),vt=s("ce7e"),_t=s("2fa4"),ft=Object(Y["a"])(ht,n,i,!1,null,null,null),gt=ft.exports;G()(ft,{VApp:dt["a"],VCard:Q["a"],VCardText:tt["a"],VCardTitle:tt["b"],VCol:et["a"],VContainer:st["a"],VDivider:vt["a"],VRow:it["a"],VSpacer:_t["a"]});var mt=s("ce5b"),bt=s.n(mt);s("bf40");a["default"].use(bt.a);var yt=new bt.a({});s("8e1f");a["default"].config.productionTip=!1,new a["default"]({vuetify:yt,render:function(t){return t(gt)}}).$mount("#app")},"5c0b":function(t,e,s){"use strict";s("9c0c")},6:function(t,e){},7:function(t,e){},8:function(t,e){},"8e1f":function(t,e,s){},9:function(t,e){},"9c0c":function(t,e,s){},fbab:function(t,e,s){}});
//# sourceMappingURL=app.a902d355.js.map