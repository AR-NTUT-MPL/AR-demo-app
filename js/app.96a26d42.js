(function(){var t={3216:function(t,e,s){"use strict";var a=s(144),i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("v-app",[s("header",[s("v-container",[s("v-row",[s("v-col",{attrs:{cols:"12",md:"8"}},[s("h1",[t._v(" Compact design principle for diffractive exit-pupil expander in AR near-eye system ")]),s("br"),s("h3",[t._v("2021 SPIE. AR|VR|MR")])]),s("v-spacer"),s("v-col",[s("h2",{staticClass:"lab-name"},[t._v("Modern Nanophotonics Lab")])])],1)],1)],1),s("section",[s("v-container",[s("v-card",[s("v-card-title",[t._v("Interactive Application")]),s("v-card-text",[s("div",{staticClass:"names"},[s("span",[t._v("Po-Han Chiu"),s("sup",[t._v("*a")])]),s("span",[t._v("Ting-Wei Huang"),s("sup",[t._v("a")])]),s("span",[t._v("Yun-Shou Hsu"),s("sup",[t._v("a")])]),s("span",[t._v("Bo-Kai Zhang"),s("sup",[t._v("a")])]),s("span",[t._v("Szu-Ta Chien"),s("sup",[t._v("a")])]),s("span",[t._v("Wen-Chang Hung"),s("sup",[t._v("b")])]),s("span",[t._v("Chien-Yi Huang"),s("sup",[t._v("b")])]),s("span",[t._v("Yu-Chieh Cheng"),s("sup",[t._v("a")])])]),s("div",[s("p",[s("sup",[t._v("a")]),t._v("National Taipei University of Technology, No. 1, Section 3, Zhongxiao East Road, Da'an Dist., Taipei, 10608, Taiwan"),s("br"),s("sup",[t._v("b")]),t._v("ASUSTeK COMPUTER INC, No. 115, Li-De Rd., Beitou Dist., Taipei 112019, Taiwan ")])])]),s("v-divider",{staticClass:"mx-4"}),s("v-card-text",[s("h3",[t._v("Abstract")]),s("p",[t._v(" For a diffractive waveguide-based augmented reality display, we demonstrate a rapid and straightforward method to define the most compact layout of an exit pupil expander (EPE) from an analysis of diffractive optical elements in k-space. The idea is to consider all k-vectors coming from in-coupling to out-coupling areas according to the grating theory, and with the geometrical tracing of the EPE region to find the optimal layout. For a working wavelength of 532 nm, 40 degrees field of view display, our method is able to fit the layout into a circular shaped area with a minimal radius or to optimize for the minimal EPE area. Furthermore, a web-based interactive application demonstrating the EPE layout calculation is provided as a layout design tool. ")]),s("p",[s("strong",[t._v("Keywords:")]),t._v(" Near-eye display, Waveguide, Augmented Reality, Exit-Pupil Expander, Diffractive Optical Elements. ")])])],1)],1)],1),s("Main"),s("footer",[s("v-container",[s("v-row",[s("v-col",[s("p",[t._v(" Web Designer/Developer: "),s("a",{staticStyle:{color:"white"},attrs:{href:"https://chiuhans111.github.io/"}},[t._v("Hans Chiu (Po-Han Chiu)")]),s("br"),t._v(" Email: t110658013@ntut.org.tw ")]),s("p",[t._v("Developed with: Vue, Vuetify, Fabric, TensorFlow")])]),s("v-col",[s("p",[t._v(" This project is aimed to give readers a interactive way to understand the principle behind waveguide based AR glasses. ")]),s("p",[t._v("Â© 2021 TaipeiTech")])])],1)],1)],1)],1)],1)},n=[],o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("section",[s("v-container",[s("v-card",[s("v-card-title",[t._v("Basic Settings")]),s("v-card-text",[s("v-row",{staticClass:"my-0"},[s("v-col",{staticClass:"py-0",attrs:{cols:"6",md:"2"}},[s("v-text-field",{attrs:{label:"Wavelength",suffix:"nm"},model:{value:t.props.wavelength,callback:function(e){t.$set(t.props,"wavelength",t._n(e))},expression:"props.wavelength"}})],1),s("v-col",{staticClass:"py-0",attrs:{cols:"6",md:"2"}},[s("v-text-field",{attrs:{label:"Refractive Index"},model:{value:t.props.material,callback:function(e){t.$set(t.props,"material",t._n(e))},expression:"props.material"}})],1),s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"6",md:"5"}},[s("v-slider",{attrs:{label:"FOV",min:"0",max:"150",tick:"1","thumb-label":""},scopedSlots:t._u([{key:"append",fn:function(){return[s("v-text-field",{staticClass:"mt-0 pt-0",attrs:{dense:"",suffix:"degrees"},model:{value:t.props.FOV,callback:function(e){t.$set(t.props,"FOV",t._n(e))},expression:"props.FOV"}})]},proxy:!0}]),model:{value:t.props.FOV,callback:function(e){t.$set(t.props,"FOV",e)},expression:"props.FOV"}})],1),s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"6",md:"3"}},[s("v-row",[s("v-col",[s("v-text-field",{attrs:{label:"Aspect"},model:{value:t.props.aspect[0],callback:function(e){t.$set(t.props.aspect,0,t._n(e))},expression:"props.aspect[0]"}})],1),s("v-col",[s("v-text-field",{model:{value:t.props.aspect[1],callback:function(e){t.$set(t.props.aspect,1,t._n(e))},expression:"props.aspect[1]"}})],1)],1)],1)],1),s("v-row",{staticClass:"my-n4"},[s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"6"}},[s("v-slider",{attrs:{label:"x offset",dense:"",min:"-1",max:"1",step:"0.1","thumb-label":""},scopedSlots:t._u([{key:"append",fn:function(){return[s("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{dense:""},model:{value:t.props.offset[0],callback:function(e){t.$set(t.props.offset,0,t._n(e))},expression:"props.offset[0]"}})]},proxy:!0}]),model:{value:t.props.offset[0],callback:function(e){t.$set(t.props.offset,0,e)},expression:"props.offset[0]"}})],1),s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"6"}},[s("v-slider",{attrs:{label:"y offset",dense:"",min:"-1",max:"1",step:"0.1"},scopedSlots:t._u([{key:"append",fn:function(){return[s("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{dense:"","thumb-label":""},model:{value:t.props.offset[1],callback:function(e){t.$set(t.props.offset,1,t._n(e))},expression:"props.offset[1]"}})]},proxy:!0}]),model:{value:t.props.offset[1],callback:function(e){t.$set(t.props.offset,1,e)},expression:"props.offset[1]"}})],1)],1)],1)],1)],1)],1),s("section",[s("v-container",[s("v-row",[s("v-col",{attrs:{sm:"6"}},[s("v-card",[s("v-card-title",[t._v("K Space ")]),s("v-card-text",[s("p",[t._v("Drag to modify grating parameters.")])]),s("KSpace",{attrs:{g1:t.props.g1,g3:t.props.g3,k0:t.k0,k1:t.k1,k2:t.k2,k3:t.k3,material:t.props.material},on:{"update:g1":function(e){return t.$set(t.props,"g1",e)},"update:g3":function(e){return t.$set(t.props,"g3",e)}}}),s("v-card-text",[s("div",[s("v-row",[s("v-col",{attrs:{cols:"2"}}),s("v-col",[s("v-label",[t._v("Period")])],1),s("v-col",[s("v-label",[t._v("Angle")])],1)],1),s("v-row",{staticClass:"mt-n4"},[s("v-col",{staticClass:"text-right mt-1",attrs:{cols:"2"}},[s("v-label",[t._v(" In ")])],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},on:{change:function(e){return t.grating_period_update("g1",e)}},model:{value:t.g1_period,callback:function(e){t.g1_period=t._n(e)},expression:"g1_period"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},on:{change:function(e){return t.grating_angle_update("g1",e)}},model:{value:t.g1_angle,callback:function(e){t.g1_angle=t._n(e)},expression:"g1_angle"}})],1)],1),s("v-row",{staticClass:"mt-n8"},[s("v-col",{staticClass:"text-right mt-1",attrs:{cols:"2"}},[s("v-label",[t._v(" EPE ")])],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:"",readonly:""},model:{value:t.g2_period,callback:function(e){t.g2_period=t._n(e)},expression:"g2_period"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:"",readonly:""},model:{value:t.g2_angle,callback:function(e){t.g2_angle=t._n(e)},expression:"g2_angle"}})],1)],1),s("v-row",{staticClass:"mt-n8"},[s("v-col",{staticClass:"text-right mt-1",attrs:{cols:"2"}},[s("v-label",[t._v(" Out ")])],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},on:{change:function(e){return t.grating_period_update("g3",e)}},model:{value:t.g3_period,callback:function(e){t.g3_period=t._n(e)},expression:"g3_period"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},on:{change:function(e){return t.grating_angle_update("g3",e)}},model:{value:t.g3_angle,callback:function(e){t.g3_angle=t._n(e)},expression:"g3_angle"}})],1)],1)],1),s("p",[t._v("Note: EPE parameters are automatically calculated.")])])],1)],1),s("v-col",{attrs:{sm:"6"}},[s("v-card",[s("v-card-title",[t._v(" Layout ")]),s("v-card-text",[s("p",[t._v("Drag to modify layout placement.")])]),s("Layout",{attrs:{in_pos:t.props.in_pos,in_size:t.props.in_size,in_shape1:t.in_shape1,in_shape2:t.in_shape2,out_pos:t.props.out_pos,out_size:t.props.out_size,out_shape1:t.out_shape1,out_shape2:t.out_shape2,epe_shape:t.epe_shape,background_image:t.background_image},on:{"update:in_pos":function(e){return t.$set(t.props,"in_pos",e)},"update:in_size":function(e){return t.$set(t.props,"in_size",e)},"update:out_pos":function(e){return t.$set(t.props,"out_pos",e)},"update:out_size":function(e){return t.$set(t.props,"out_size",e)}}}),s("v-card-text",[s("div",[s("v-row",[s("v-col",{attrs:{cols:"2"}}),s("v-col",[s("v-label",[t._v("x")])],1),s("v-col",[s("v-label",[t._v("y")])],1),s("v-col",[s("v-label",[t._v("z")])],1)],1),s("v-row",{staticClass:"mt-n4"},[s("v-col",{staticClass:"text-right mt-1",attrs:{cols:"2"}},[s("v-label",[t._v("In")])],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},model:{value:t.props.in_pos[0],callback:function(e){t.$set(t.props.in_pos,0,t._n(e))},expression:"props.in_pos[0]"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},model:{value:t.props.in_pos[1],callback:function(e){t.$set(t.props.in_pos,1,t._n(e))},expression:"props.in_pos[1]"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},model:{value:t.props.in_displace,callback:function(e){t.$set(t.props,"in_displace",t._n(e))},expression:"props.in_displace"}})],1)],1),s("v-row",{staticClass:"mt-n8"},[s("v-col",{staticClass:"text-right mt-1",attrs:{cols:"2"}},[s("v-label",[t._v("Out")])],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},model:{value:t.props.out_pos[0],callback:function(e){t.$set(t.props.out_pos,0,t._n(e))},expression:"props.out_pos[0]"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},model:{value:t.props.out_pos[1],callback:function(e){t.$set(t.props.out_pos,1,t._n(e))},expression:"props.out_pos[1]"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:""},model:{value:t.props.out_displace,callback:function(e){t.$set(t.props,"out_displace",t._n(e))},expression:"props.out_displace"}})],1)],1),s("v-row",{staticClass:"mt-n4"},[s("v-col",[s("v-row",{staticClass:"mt-n4"},[s("v-col",[s("v-select",{attrs:{items:t.shape_types,label:"In shape",dense:""},model:{value:t.props.in_shape_type,callback:function(e){t.$set(t.props,"in_shape_type",e)},expression:"props.in_shape_type"}})],1)],1),s("v-row",{staticClass:"mt-n4"},[s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:"",label:"width"},model:{value:t.props.in_size[0],callback:function(e){t.$set(t.props.in_size,0,t._n(e))},expression:"props.in_size[0]"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:"",label:"height"},model:{value:t.props.in_size[1],callback:function(e){t.$set(t.props.in_size,1,t._n(e))},expression:"props.in_size[1]"}})],1)],1)],1),s("v-col",[s("v-row",{staticClass:"mt-n4"},[s("v-col",[s("v-select",{attrs:{items:t.shape_types,label:"Out shape",dense:""},model:{value:t.props.out_shape_type,callback:function(e){t.$set(t.props,"out_shape_type",e)},expression:"props.out_shape_type"}})],1)],1),s("v-row",{staticClass:"mt-n4"},[s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:"",label:"width"},model:{value:t.props.out_size[0],callback:function(e){t.$set(t.props.out_size,0,t._n(e))},expression:"props.out_size[0]"}})],1),s("v-col",[s("v-text-field",{staticClass:"ma-0 pa-0",attrs:{dense:"",label:"height"},model:{value:t.props.out_size[1],callback:function(e){t.$set(t.props.out_size,1,t._n(e))},expression:"props.out_size[1]"}})],1)],1)],1)],1)],1)])],1)],1)],1)],1)],1),s("section",[s("v-container",[s("v-card",[s("v-card-title",[t._v(" Customization ")]),s("v-card-text",[s("v-row",[s("v-col",[s("v-file-input",{attrs:{label:"Background Image",dense:""},on:{change:t.update_background_image}})],1)],1)],1)],1)],1)],1),s("section",[s("v-container",[s("v-card",[s("v-card-title",[t._v(" Parameters ")]),s("v-card-text",[t._l(Object.keys(t.props),(function(e){return[s("v-row",{key:e,staticClass:"mt-n4"},[s("v-col",{staticClass:"text-right",attrs:{cols:"4",sm:"3"}},[s("label",{attrs:{for:e}},[t._v(t._s(e)+": ")])]),s("v-col",[t.isArray(t.props[e])?t._l(t.props[e],(function(a,i){return s("span",{key:i},[s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.props[e][i],expression:"props[prop][i]",modifiers:{number:!0}}],attrs:{name:e,type:"text"},domProps:{value:t.props[e][i]},on:{input:function(s){s.target.composing||t.$set(t.props[e],i,t._n(s.target.value))},blur:function(e){return t.$forceUpdate()}}})])})):[s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.props[e],expression:"props[prop]",modifiers:{number:!0}}],attrs:{name:e,type:"text"},domProps:{value:t.props[e]},on:{input:function(s){s.target.composing||t.$set(t.props,e,t._n(s.target.value))},blur:function(e){return t.$forceUpdate()}}})]],2)],1)]}))],2)],1)],1)],1),s("div",{attrs:{hidden:""}},[t._v(" "+t._s(t.epe_shape_prop)+" ")])])},r=[],p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"base"},[s("canvas",{ref:"canvas",staticClass:"canvas",attrs:{width:"500",height:"500"}}),s("div",{attrs:{hidden:""}},[t._v(" "+t._s(t.g1_props)+" "+t._s(t.g3_props)+" "+t._s(t.points)+" "+t._s(t.circle_props)+" ")])])},l=[],c=s(2777),h={data(){return{canvas:null,alive:!1}},mounted(){this.alive=!0,this.canvas=new c.fabric.Canvas(this.$refs.canvas),window.addEventListener("resize",this.resize_event),this.resize()},destroyed(){this.alive=!1,this.canvas.dispose(),window.removeEventListener("resize",this.resize_event)},methods:{resize_event(){this.resize()},resize(){},updatePolygon(t){const{width:e,height:s,left:a,top:i}=t._calcDimensions(),n=2*Math.max(Math.abs(a),Math.abs(a+e)),o=2*Math.max(Math.abs(i),Math.abs(i+s));t.set({width:n,height:o}).setCoords()}}};function u(t,e){let s=null,a=null,i=null;function n(){const n=this,o=arguments;let r=(new Date).getTime();return clearTimeout(a),!s||r-s>e?(i=t.apply(n,o),s=r):a=setTimeout((()=>{i=t.apply(n,o),s=null}),e),i}return n}function d(t){let e=null,s=!1;function a(){const i=this,n=arguments;if(clearTimeout(e),!s)return s=!0,new Promise((e=>{t.apply(i,n).then((()=>{e(arguments)})).finally((()=>{s=!1}))}));e=setTimeout((()=>{a.apply(i,n)}),0)}return a}var _=s(9756);function v(t){let e=0;for(let s of t)e+=s**2;return e}function f(t){return Math.sqrt(v(t))}_.CQI("cpu");const g=function(t,e,s,a,i,n){const o=f([i,n]),r=o/2/Math.tan(e/2),p=.5*i*s,l=.5*n*a,c=P(+p,+l,+i-2*Math.abs(p),+n-2*Math.abs(l),8);return _.B90([p,l]),c.div(c.pow(2).sum(0).add(r**2).sqrt()).mul(t)},m=function(t,e){return _.IHx(_.XeE(t),_.XeE([[e[0]],[e[1]]]))},y=function(t,e=null){const s=_.J69(_.mCk(t),e),a=_.J69(_.O$l(t),e);return _.fvJ(a,s)},b=function(t){const e=_.fvJ(t[0],t[1]),s=e.sub(y(e)).add(Math.PI).mod(2*Math.PI).sub(Math.PI),a=_.NqF(s).arraySync(),i=_.vHJ(s).arraySync();return _.B90([e,s]),[a,i]},k=function(t,e){return _._b3(_.luU(e**2,_.dC7(t,t).sum(0)))},x=function(t,e){return _.hiC(t,k(t,e))};function C(t,e=null){return _.zoF([_.Fp7(t,e,!0),_.VV$(t,e,!0)],e)}const w=async function(t,e,s,a,i,n,o,r,p,l){const c=x(r,o).mul(s),h=x(r,o).mul(-n),u=_.dt4(t,1).add(c),d=_.dt4(a,1).add(h),v=_.luU(d,u),f=_.dC7([p[1],p[0]],[[-1],[1]]),g=_.dC7([l[1],l[0]],[[-1],[1]]),m=d.sub(_.pju(l,"float32").mul(_.dC7(v,f).sum(0)).div(_.dC7(l,f).sum(0))),y=C(_.dC7(_.dt4(e,1),_.dt4(f,2)).sum(0),1).mul(_.dC7(f,l).sum(0).div(_.dC7(f,f).sum(0)).div(_.dC7(l,l).sum(0)).expandDims(1)),b=C(_.dC7(_.dt4(i,1),_.dt4(g,2)).sum(0),1).mul(_.dC7(g,p).sum(0).div(_.dC7(g,g).sum(0)).div(_.dC7(p,p).sum(0)).expandDims(1));_.B90(v,f,g,m);const k=_.dC7(b.gather(0,1),p),w=_.dC7(b.gather(1,1),p),P=_.dC7(y.gather(0,1),l),z=_.dC7(y.gather(1,1),l),$=await V(_.zoF([m.add(k).add(P),m.add(w).add(P),m.add(k).add(z),m.add(w).add(z)],1)).array(),M=await E(c,e).array(),S=await E(h,i).array();return _.B90(b,y,k,w,P,z),[M,$,S]};function P(t,e,s,a,i){let n=_.w6H(0,i+1).div(i).sub(.5),o=n.reverse();n=n.slice(0,i),o=o.slice(0,i);let r=_.iUs([i]).mul(.5),p=r.mul(-1),l=_.gME([n,r,o,p]).mul(s).add(t),c=_.gME([p,n,r,o]).mul(a).add(e);return _.Izb([l.expandDims(0),c.expandDims(0)])}function z(t,e,s,a,i){let n=_.w6H(0,i).div(i).mul(2*Math.PI),o=_.mCk(n).mul(s/2).add(t),r=_.O$l(n).mul(a/2).add(e);return _.Izb([o.expandDims(0),r.expandDims(0)])}function $(t,e){let s=[];for(let a=0;a<t[0].length;a++)s.push({x:t[0][a]*e,y:-t[1][a]*e});return s}function M(t,e){let[s,a]=b(t);return[{x:0,y:0},{x:t[0][s]*e,y:-t[1][s]*e},{x:t[0][a]*e,y:-t[1][a]*e}]}function S(t,e,s){return(e[0]-t[0])*(s[1]-t[1])-(e[1]-t[1])*(s[0]-t[0])}function A(t){let e=[];for(let i=0;i<t[0].length;i++)e.push(i);e.sort(((e,s)=>t[0][e]<t[0][s]?-1:t[0][e]>t[0][s]?1:t[1][e]-t[1][s]));let s=[],a=[];for(let i of e){while(a.length>=2&&S([t[0][a[a.length-2]],t[1][a[a.length-2]]],[t[0][a[a.length-1]],t[1][a[a.length-1]]],[t[0][i],t[1][i]])<=0)a.pop();while(a.length>=2&&S([t[0][s[s.length-2]],t[1][s[s.length-2]]],[t[0][s[s.length-1]],t[1][s[s.length-1]]],[t[0][i],t[1][i]])>=0)s.pop();a.push(i),s.push(i)}return a.concat(s.slice(1,-1).reverse())}function V(t){let e=_.pju(t,"float32");t=e.arraySync();let s=A(t);return e.gather(s,1)}const E=function(t,e){let s=_.dt4(t,1),a=_.dt4(e,2);return V(s.add(a).reshape([2,-1]))};var O={props:{g1:Array,g3:Array,k0:Number,k1:Array,k2:Array,k3:Array,material:Number},mixins:[h],data(){return{canvas:null,k1_shape:null,k2_shape:null,k3_shape:null,circle1:null,circle2:null,k2_span_shape:null,k3_span_shape:null}},mounted(){this.canvas.add(this.k1_shape=new c.fabric.Polygon([],{fill:"#37474f",left:0,top:0,originX:"center",originY:"center",evented:!1})),this.canvas.add(this.k2_span_shape=new c.fabric.Polygon([],{fill:"#ffcc8080",left:0,top:0,originX:"center",originY:"center",evented:!1})),this.canvas.add(this.k3_span_shape=new c.fabric.Polygon([],{fill:"#90caf980",left:0,top:0,originX:"center",originY:"center",evented:!1})),this.canvas.add(this.circle1=new c.fabric.Circle({stroke:"black",fill:null,strokeWidth:2,radius:1e3,selectable:!1,originX:"center",originY:"center",evented:!1})),this.canvas.add(this.circle2=new c.fabric.Circle({stroke:"black",fill:null,strokeWidth:2,radius:1e3,selectable:!1,originX:"center",originY:"center",evented:!1})),this.canvas.set("scaleY",-1),this.k2_shape=this.create_k_patch("#ff9800",this.g1_update),this.k3_shape=this.create_k_patch("#2196f3",this.g3_update),this.canvas.absolutePan(new c.fabric.Point(-this.canvas.width/2,-this.canvas.height/2)),this.canvas.selection=!1},methods:{resize(){let t=this.$refs.base.getBoundingClientRect().width;this.canvas.setWidth(t),this.canvas.setHeight(t),this.canvas.calcOffset(),this.canvas.absolutePan(new c.fabric.Point(-this.canvas.width/2,-this.canvas.height/2))},create_k_patch(t,e){let s=new c.fabric.Polygon([],{fill:t,originX:"center",originY:"center",stroke:"white",strokeWidth:2,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,hasControls:!1}).on("modified",e).on("moving",e);return this.canvas.add(s),s},g1_update:u((function(){this.$emit("update:g1",[this.k2_shape.get("left")/this.scaling,-this.k2_shape.get("top")/this.scaling])}),20),g3_update:u((function(){this.$emit("update:g3",[-this.k3_shape.get("left")/this.scaling,this.k3_shape.get("top")/this.scaling])}),20)},computed:{k0_mat(){return this.k0*this.material},scaling(){return this.canvas.width/2/this.k0_mat*.8},g1_props(){return this.k2_shape?(this.k2_shape.set("left",this.g1[0]*this.scaling),this.k2_shape.set("top",-this.g1[1]*this.scaling),this.k2_shape.setCoords(),this.k2_span_shape.set("points",M(this.k2,this.scaling)),this.updatePolygon(this.k2_span_shape),this.canvas.requestRenderAll(),0):0},g3_props(){return this.k3_shape?(this.k3_shape.set("left",-this.g3[0]*this.scaling),this.k3_shape.set("top",this.g3[1]*this.scaling),this.k3_shape.setCoords(),this.k3_span_shape.set("points",M(this.k3,this.scaling)),this.updatePolygon(this.k3_span_shape),this.canvas.requestRenderAll(),0):0},points(){if(!this.k1_shape)return 0;let t=$(this.k1,this.scaling);return this.k1_shape.set("points",t),this.k2_shape.set("points",t),this.k3_shape.set("points",t),this.updatePolygon(this.k1_shape),this.updatePolygon(this.k2_shape),this.updatePolygon(this.k3_shape),this.canvas.requestRenderAll(),0},circle_props(){return this.circle1?(this.circle1.set("radius",this.k0*this.scaling),this.circle2.set("radius",this.k0_mat*this.scaling),this.circle1.setCoords(),this.circle2.setCoords(),this.canvas.requestRenderAll(),0):0}}},I=O,T=s(3736),R=(0,T.Z)(I,p,l,!1,null,null,null),Z=R.exports,F=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"base"},[s("div",{staticClass:"layout-container"},[s("div",{staticClass:"layout-canvas-bg",style:{backgroundImage:"url("+t.background_image+")"}}),s("div",[s("canvas",{ref:"canvas",staticClass:"canvas",attrs:{width:"500",height:"500"}})])]),s("div",{attrs:{hidden:""}},[t._v(" "+t._s(t.in_props)+" "+t._s(t.out_props)+" "+t._s(t.epe_props)+" ")])])},D=[],Y={props:{in_pos:Array,in_size:Array,in_shape1:Array,in_shape2:Array,out_pos:Array,out_size:Array,out_shape1:Array,out_shape2:Array,epe_shape:Array,background_image:String},mixins:[h],data(){return{canvas:null,in_patch1:null,in_patch2:null,out_patch1:null,out_patch2:null,epe_patch:null}},mounted(){this.canvas.selection=!1,this.canvas.add(this.in_patch2=new c.fabric.Polygon([],{fill:"#37474f80",originX:"center",originY:"center",evented:!1})),this.canvas.add(this.out_patch2=new c.fabric.Polygon([],{fill:"#2196f380",originX:"center",originY:"center",evented:!1})),this.canvas.add(this.epe_patch=new c.fabric.Polygon([],{fill:"#ff980080",originX:"center",originY:"center",evented:!1})),this.in_patch1=this.create_coupling_patch("#37474f",this.in_update),this.out_patch1=this.create_coupling_patch("#2196f3",this.out_update)},methods:{resize(){let t=this.$refs.base.getBoundingClientRect().width;this.canvas.setWidth(t),this.canvas.setHeight(t),this.canvas.calcOffset(),this.canvas.absolutePan(new c.fabric.Point(-this.canvas.width/2,-this.canvas.height/2))},create_coupling_patch(t,e){let s=new c.fabric.Polygon([],{fill:t,originX:"center",originY:"center",lockRotation:!0,width:100,height:100}).on("modified",e).on("moving",e);return this.canvas.add(s),s},in_update:u((function(){this.$emit("update:in_pos",[this.in_patch1.get("left")/this.scaling,-this.in_patch1.get("top")/this.scaling]),this.$emit("update:in_size",[this.in_patch1.get("scaleX")*this.in_size[0],this.in_patch1.get("scaleY")*this.in_size[1]]),this.in_patch1.set("scaleX",1),this.in_patch1.set("scaleY",1)}),20),out_update:u((function(){this.$emit("update:out_pos",[this.out_patch1.get("left")/this.scaling,-this.out_patch1.get("top")/this.scaling]),this.$emit("update:out_size",[this.out_patch1.get("scaleX")*this.out_size[0],this.out_patch1.get("scaleY")*this.out_size[1]]),this.out_patch1.set("scaleX",1),this.out_patch1.set("scaleY",1)}),20)},computed:{scaling(){return this.canvas.width/80},in_props(){return this.in_patch1?(this.in_patch1.set("left",this.in_pos[0]*this.scaling),this.in_patch1.set("top",-this.in_pos[1]*this.scaling),this.in_patch1.setCoords(),this.in_patch1.set("points",$(this.in_shape1,this.scaling)),this.updatePolygon(this.in_patch1),this.in_patch2.set("left",this.in_pos[0]*this.scaling),this.in_patch2.set("top",-this.in_pos[1]*this.scaling),this.in_patch2.setCoords(),this.in_patch2.set("points",$(this.in_shape2,this.scaling)),this.updatePolygon(this.in_patch2),this.canvas.requestRenderAll(),0):0},out_props(){return this.out_patch1?(this.out_patch1.set("left",this.out_pos[0]*this.scaling),this.out_patch1.set("top",-this.out_pos[1]*this.scaling),this.out_patch1.setCoords(),this.out_patch1.set("points",$(this.out_shape1,this.scaling)),this.updatePolygon(this.out_patch1),this.out_patch2.set("left",this.out_pos[0]*this.scaling),this.out_patch2.set("top",-this.out_pos[1]*this.scaling),this.out_patch2.setCoords(),this.out_patch2.set("points",$(this.out_shape2,this.scaling)),this.updatePolygon(this.out_patch2),this.canvas.requestRenderAll(),0):0},epe_props(){return this.out_patch1?(this.epe_patch.set("points",$(this.epe_shape,this.scaling)),this.updatePolygon(this.epe_patch),this.canvas.requestRenderAll(),0):0}}},X=Y,N=(0,T.Z)(X,F,D,!1,null,"b86eeaf8",null),B=N.exports;const H=2*Math.PI/394;var j={name:"HelloWorld",components:{KSpace:Z,Layout:B},props:{},data(){return{props:{wavelength:530,material:1.827,FOV:40,aspect:[4,3],offset:[0,0],g1:[H,0],g3:[0,-H],in_size:[4,4],in_displace:0,in_pos:[-25,-15],in_shape_type:"circle",out_size:[16,16],out_displace:20,out_pos:[5,15],out_shape_type:"circle"},epe_shape:[[0],[0]],in_shape2:[[0],[0]],out_shape2:[[0],[0]],shape_types:["circle","rectangle"],background_image:""}},methods:{isArray(t){return t instanceof Array},grating_period_update(t,e){if(isNaN(e)&&(e=0),0!=e){let s=2*Math.PI/e/f(this.props[t]);this.props[t][0]*=s,this.props[t][1]*=s,this.props[t].__ob__.dep.notify()}},grating_angle_update(t,e){isNaN(e)&&(e=0);let s=f(this.props[t]);this.props[t][0]=Math.cos(e*Math.PI/180)*s,this.props[t][1]=Math.sin(e*Math.PI/180)*s,this.props[t].__ob__.dep.notify()},update_epe:u(d((async function(){const t=this,[e,s,a]=await w(...arguments);return t.in_shape2=e,t.epe_shape=s,t.out_shape2=a,this.report(),0})),1),report:u((function(){window.dataLayer.push({event:"interact",props:this.props})}),1e4),update_background_image(t){if(t){let e=new FileReader,s=this;e.onloadend=function(){s.background_image=e.result,console.log(e.result),window.dataLayer.push({event:"interact",filename:t.name})},e.readAsDataURL(t)}}},computed:{k0(){return 2*Math.PI/this.props.wavelength},k1(){return g(this.k0,this.props.FOV/180*Math.PI,...this.props.offset,...this.props.aspect).arraySync()},k2(){return m(this.k1,this.props.g1).arraySync()},k3(){return m(this.k2,this.g2).arraySync()},TIR(){return Math.asin(1/this.props.material)},g2(){return[-this.props.g1[0]-this.props.g3[0],-this.props.g1[1]-this.props.g3[1]]},g1_period:{get(){return 2*Math.PI/f(this.props.g1)},set(){}},g1_angle:{get(){return 180*Math.atan2(this.props.g1[1],this.props.g1[0])/Math.PI},set(){}},g2_period:{get(){return 2*Math.PI/f(this.g2)},set(){}},g2_angle:{get(){return 180*Math.atan2(this.g2[1],this.g2[0])/Math.PI},set(){}},g3_period:{get(){return 2*Math.PI/f(this.props.g3)},set(){}},g3_angle:{get(){return 180*Math.atan2(this.props.g3[1],this.props.g3[0])/Math.PI},set(){}},in_shape1(){return"circle"==this.props.in_shape_type?z(0,0,...this.props.in_size,32).arraySync():P(0,0,...this.props.in_size,1).arraySync()},out_shape1(){return"circle"==this.props.out_shape_type?z(0,0,...this.props.out_size,32).arraySync():P(0,0,...this.props.out_size,1).arraySync()},epe_shape_prop(){return this.update_epe(this.props.in_pos,this.in_shape1,this.props.in_displace,this.props.out_pos,this.out_shape1,this.props.out_displace,this.k0,this.k1,this.k2,this.k3),0}}},L=j,W=s(3453),q=s.n(W),U=s(1410),K=s(4886),J=s(266),Q=s(2118),G=s(7488),tt=s(4208),et=s(1713),st=s(6887),at=s(3595),it=s(9289),nt=(0,T.Z)(L,o,r,!1,null,"3b1a8a10",null),ot=nt.exports;q()(nt,{VCard:U.Z,VCardText:K.ZB,VCardTitle:K.EB,VCol:J.Z,VContainer:Q.Z,VFileInput:G.Z,VLabel:tt.Z,VRow:et.Z,VSelect:st.Z,VSlider:at.Z,VTextField:it.Z});var rt={name:"App",components:{Main:ot}},pt=rt,lt=s(1372),ct=s(4920),ht=s(3687),ut=(0,T.Z)(pt,i,n,!1,null,null,null),dt=ut.exports;q()(ut,{VApp:lt.Z,VCard:U.Z,VCardText:K.ZB,VCardTitle:K.EB,VCol:J.Z,VContainer:Q.Z,VDivider:ct.Z,VRow:et.Z,VSpacer:ht.Z});var _t=s(707),vt=s.n(_t);s(6469);a["default"].use(vt());var ft=new(vt())({});a["default"].config.productionTip=!1,new a["default"]({vuetify:ft,render:t=>t(dt)}).$mount("#app")},5410:function(){},8628:function(){},1601:function(){},7792:function(){},4977:function(){},4960:function(){},6759:function(){},6272:function(){},5042:function(){}},e={};function s(a){var i=e[a];if(void 0!==i)return i.exports;var n=e[a]={id:a,loaded:!1,exports:{}};return t[a].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}s.m=t,function(){s.amdD=function(){throw new Error("define cannot be used indirect")}}(),function(){s.amdO={}}(),function(){var t=[];s.O=function(e,a,i,n){if(!a){var o=1/0;for(c=0;c<t.length;c++){a=t[c][0],i=t[c][1],n=t[c][2];for(var r=!0,p=0;p<a.length;p++)(!1&n||o>=n)&&Object.keys(s.O).every((function(t){return s.O[t](a[p])}))?a.splice(p--,1):(r=!1,n<o&&(o=n));if(r){t.splice(c--,1);var l=i();void 0!==l&&(e=l)}}return e}n=n||0;for(var c=t.length;c>0&&t[c-1][2]>n;c--)t[c]=t[c-1];t[c]=[a,i,n]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var i,n,o=a[0],r=a[1],p=a[2],l=0;if(o.some((function(e){return 0!==t[e]}))){for(i in r)s.o(r,i)&&(s.m[i]=r[i]);if(p)var c=p(s)}for(e&&e(a);l<o.length;l++)n=o[l],s.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return s.O(c)},a=self["webpackChunkar_demo_app"]=self["webpackChunkar_demo_app"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(3216)}));a=s.O(a)})();
//# sourceMappingURL=app.96a26d42.js.map